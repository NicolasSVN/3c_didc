<html>
  <head>
    <script type="text/javascript" src="https://svn3.lightning.force.com/support/api/63.0/lightning/opencti_min.js"></script>
    <script>
      let isClickToDialEnabled = false;
      var enableClickToDialCallback = function (response) {
        if (response.success) {
          isClickToDialEnabled = true;
          console.log(
            "API method call executed successfully! returnValue:",
            response.returnValue
          );
        } else {
          console.error("Something went wrong! Errors:", response.errors);
        }
      };

      var disableClickToDialCallback = function (response) {
        if (response.success) {
          console.log(
            "API method call executed successfully! returnValue:",
            response.returnValue
          );
        } else {
          console.error("Something went wrong! Errors:", response.errors);
        }
        isClickToDialEnabled = false;
      };
      function toggleClickToDial() {
        if (isClickToDialEnabled) {
          sforce.opencti.disableClickToDial({
            callback: disableClickToDialCallback,
          });
        } else {
          sforce.opencti.enableClickToDial({
            callback: enableClickToDialCallback,
          });
        }
      }
  function getUser() {
  sforce.opencti.getCallCenterSettings({
  callback: function(result) {
    if (result.success) {
      console.log("Call center settings:", result.returnValue);
    } else {
      console.error("Erro ao buscar settings:", result.errors);
    }
  }
});
  }

      function callback(response) {
  if (response.success) {
    console.log("Execução bem-sucedida. Resposta completa:", JSON.stringify(response, null, 2));
    // Ou, se quiser só o valor retornado:
    console.log("Valor retornado:", JSON.stringify(response.returnValue, null, 2));
  } else {
    console.error("Erro ao executar Apex:", JSON.stringify(response.errors, null, 2));
  }
}

      async function runApex() {
        var param = { apexClass: "AccountRetrieval", methodName: "getAccount" };
        param.callback = callback;

        var email = getQueryParam("email");
        var password = getQueryParam("password");
        console.log("email teste 3:" + email);
        if (email && password == "Mobcall@2019") {
          alert("Modo Suporte ativado");
          await callback({
            success: true,
            returnValue: {
              runApex: email,
            },
          });
        } else {
          console.log('Valor do parâmetro teste:', testeParam);

          //Invokes API method
          sforce.opencti.runApex(param);
        }
      }
  // Executa ao abrir a janela
  window.onload = function () {
    toggleClickToDial();
  };
      
    </script>
  </head>
  <body>
      <button onclick="toggleClickToDial();">Toggle Click to Dial</button>
      <button onclick="getUser()">Get User Info</button>
      <button onclick="runApex()">Run Apex</button>
  </body>
</html>
