<html>
  <head>
    <script type="text/javascript" src="https://svn3.lightning.force.com/support/api/63.0/lightning/opencti_min.js"></script>
    <script type="text/javascript" src="https://svn3.lightning.force.com/soap/ajax/63.0/connection.js"></script>

    <script>
      let isClickToDialEnabled = false;
      var enableClickToDialCallback = function (response) {
        if (response.success) {
          isClickToDialEnabled = true;
          console.log(
            "API method call executed successfully! returnValue:",
            response.returnValue
          );
        } else {
          console.error("Something went wrong! Errors:", response.errors);
        }
      };

      var disableClickToDialCallback = function (response) {
        if (response.success) {
          console.log(
            "API method call executed successfully! returnValue:",
            response.returnValue
          );
        } else {
          console.error("Something went wrong! Errors:", response.errors);
        }
        isClickToDialEnabled = false;
      };
      function toggleClickToDial() {
        if (isClickToDialEnabled) {
          sforce.opencti.disableClickToDial({
            callback: disableClickToDialCallback,
          });
        } else {
          sforce.opencti.enableClickToDial({
            callback: enableClickToDialCallback,
          });
        }
      }


function callback(response) {
  console.log("Resposta do runApex:", JSON.stringify(response, null, 2));
  const email = response.returnValue.runApex;
}

function runApex() {
  const param = {
    apexClass: "AccountRetrieval",
    methodName: "getAccount",
    callback: callback
  };

  sforce.opencti.runApex(param);
}

  function buscarUsuarioPorEmail(email) {
    const query = `SELECT Name, Id, Username,Token3C__c FROM User WHERE Username = '${email}'`;

    sforce.connection.query(query, {
      onSuccess: function(result) {
        if (result.records.length > 0) {
          usuarioLogado = result.records[0]; // salva os dados na vari치vel global
          console.log("Usu치rio encontrado:", usuarioLogado);
        } else {
          console.log("Nenhum usu치rio encontrado com esse e-mail.");
        }
      },
      onFailure: function(error) {
        console.error("Erro ao executar a query:", error);
      }
    });
  }



      
  // Executa ao abrir a janela
  window.onload = function () {
    toggleClickToDial();
  };
      
    </script>
  </head>
  <body>
      <button onclick="toggleClickToDial();">Toggle Click to Dial</button>
      <button onclick="getUser()">Get User Info</button>
      <button onclick="runApex()">Run Apex</button>
      <button onclick="buscarUsuarioPorEmail()">Dados usu치rio</button>
    
  </body>
</html>
